<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" ng-app="main">

<head>
    <meta charset="utf-8" />
    <title>便當來了</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- styles -->
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="stylesheets/xeditable.css" rel="stylesheet" media="screen">
    <link href="stylesheets/style.css" rel="stylesheet" media="screen">
    <link href="stylesheets/browse.css" rel="stylesheet" media="screen">
</head>

<body>
    <div class="container" hidden>
        <!-- navbar -->
        <div ng-include="'header'"></div>

        <div class="main-view" ng-controller="browseController">
            <!--
          container
            stores list
              stores-name-list
              store-creation
            store-view
              image-view         60%
              store-info-view    40%
              party-creation     fixed bottom
            store-detail-view
              products-list      60%
              product-creation
              comments-view      40%
                comments-list
                comment-creation   fixed bottom
        -->
            <div class="row">
                <div class="stores-list col-md-3 panel panel-default main-layout">
                    <div class="panel-heading">店家列表</div>
                    <div class="stores-name-list panel-body table-container">
                        <table class="table table-hover">
                            <tbody>
                                <tr ng-repeat="store in storesList" ng-class="{active: store.id == selectStore.id}">
                                    <td>
                                        <a href="" ng-click="clickStore($index)">{{store.name}}</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Role: Manager -->
                    <div class="store-creation" ng-show="userInfo.role >= 1">
                        <div class="ready-to-create" ng-show="!storeCreationFormVisible">
                            <button class="btn btn-default btn-block" ng-click="onClickStoreCreationButton()">
                                新增店家
                            </button>
                        </div>

                        <div class="store-creation-form" ng-show="storeCreationFormVisible">
                            <form novalidate>
                                <div class="form-group">
                                    <label>店家名稱</label>
                                    <input type="text" class="form-control new-store-name" placeholder="輸入店家名稱 ..." ng-model="newStore.name" required/>
                                    <label>電話</label>
                                    <input type="text" class="form-control" placeholder="如: 03-3301234" ng-model="newStore.phone_number" required/>
                                    <label>滿多少外送</label>
                                    <input type="text" class="form-control" ng-model="newStore.min_spending" required/>
                                    <br/>
                                    <button type="submit " class="btn btn-success pull-right " ng-click="onSubmitNewStore(newStore) ">添加</button>
                                    <button type="button " class="btn btn-default pull-right " ng-click="onClickNewStoreCancel() ">取消</button>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>

                <div class="store-view col-md-3 panel panel-default main-layout " ng-show="selectStore != null">
                    <div class="panel-heading">
                        店家資訊
                    </div>
                    <div class="image-view panel-body">
                        <!-- todo: show image if exist -->
                        <!-- ngSrc trick for update -->
                        <a href="{{ selectStore.image }}" target="_blank" class="thumbnail">
                            <img ng-src="{{ selectStore.image || '//:0' }}" alt="Description">
                        </a>
                        <!-- img ng-src="{{ selectStore.image || '//:0' }} " alt="Description " class="img-thumbnail " / -->
                        <div class="image-upload " ng-show="userInfo.role>= 1">
                            <button type="button " class="btn btn-default btn-block" data-toggle="modal" data-target="#myModal">
                                上傳圖片
                            </button>
                            <div class="modal fade " id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                            <h4 class="modal-title" id="myModalLabel">上傳圖片</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div ng-include="'file-upload'"></div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">關閉</button>
                                            <button type="button" class="btn btn-success" ng-click="onUploadStoreImageDone()">確認</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="store-info-view">
                        <div ng-show="userInfo.role == 0">
                            <p>名稱：{{selectStore.name}}</p>
                            <p>電話：{{selectStore.phone_number}}</p>
                            <p>滿多少外送：{{selectStore.min_spending}}</p>
                        </div>
                        
                        <div ng-show="userInfo.role >= 1">
                            <p>名稱：<a href="#" editable-text="selectStore.newName" onbeforesave="onUpdateStoreName($data)" buttons="no">{{selectStore.newName || 'empty'}}</a></p>
                            <p>電話：<a href="#" editable-text="selectStore.newPhoneNumber" onbeforesave="onUpdateStorePhoneNumber($data)" buttons="no">{{selectStore.newPhoneNumber || 'empty'}}</a></p>
                            <p>滿多少外送：<a href="#" editable-text="selectStore.newMinSpending" onbeforesave="onUpdateStoreMinSpending($data)" buttons="no">{{selectStore.newMinSpending || 'empty'}}</a></p>
                        </div>
                    </div>

                    <br/>

                    <div class="party-creation" ng-show="partyCreationVisible && (userInfo.role >= 1)">
                        <button class="ready-to-create-party btn btn-default btn-block " ng-show="!partyCreationFormVisible
                                " ng-click="onClickPartyCreationButton() ">
                            新增便當團
                        </button>
                        <div class="party-creation-form " ng-show="partyCreationFormVisible ">
                            <form novalidate>
                                <div class="form-group" ng-controller="dateTimeController ">
                                    <label>便當團名稱</label>
                                    <input type="text" class="form-control " ng-model="newParty.name " required>
                                    <label>開始時間</label>
                                    <input type="text" class="datepicker form-control " datetime="yyyy-MM-dd hh:mm:ss a " ng-model="newParty.create_date " required>
                                    <label>結束時間</label>
                                    <input type="text" class="form-control " datetime="yyyy-MM-dd hh:mm:ss a " ng-model="newParty.expired_date " required>
                                    <br>
                                    <button type="submit " class="btn btn-success pull-right " ng-click="onSubmitNewParty(newParty) ">添加</button>
                                    <button type="button " class="btn btn-default pull-right " ng-click="onClickPartyCreationCancel() ">取消</button>
                                </div>
                            </form>
                        </div>
                        <!-- Show party creation view if authority passed -->
                    </div>
                </div>

                <!-- store-detail-view -->
                <div class="store-detail-view col-md-6 panel panel-default main-layout" ng-show="selectStore != null ">
                    <div class="products-view">

                        <div class="product-creation panel panel-default" ng-show="newProduct.enable && userInfo.role >= 1">
                            <div class="panel-heading">商品列表</div>
                            <div class="panel-body">
                                <button class="ready-to-create-product btn btn-default btn-block" ng-show="!newProduct.formVisible" ng-click="newProduct.onClickFormVisible() ">
                                    新增商品
                                </button>
                                <div class="product-creation-form" ng-show="newProduct.formVisible">
                                    <form novalidate>
                                        <div class="form-group">
                                            <label>商品名稱</label>
                                            <input type="text " class="form-control new-product-name" ng-model="newProduct.data.name " placeholder="不可為空" required>
                                            <label>售價</label>
                                            <input type="text " class="form-control" ng-model="newProduct.data.price " placeholder="填入超過 0 的金額 " required>
                                            <br/>
                                            <button type="submit" class="btn btn-success pull-right" ng-click="newProduct.onSubmit(newProduct)" ng-disabled="newProduct.data.price <= 0">添加</button>
                                            <button type="button" class="btn btn-default pull-right" ng-click="newProduct.onCancel()">取消</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="table-container">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="text" class="col-lg-3" placeholder="商品篩選器 ...">
                                        </th>
                                        <th>售價</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="product in productsList " ng-class="{active: product.product_id == selectProduct.product_id} ">
                                        <td>
                                            <a href=" " ng-click="clickProduct($index) ">{{product.product_name}}</a>
                                        </td>
                                        <td>{{product.price | currency}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>


                    </div>
                    <br/>
                    <div class="comments-view " ng-show="selectProduct != null">
                        <div class="comments-list ">
                            <div class="panel panel-default ">
                                <div class="panel-heading ">評論：{{selectStore.name}} 的 {{selectProduct.product_name}}</div>
                                <div class="panel-body ">
                                    <ul>
                                        <li ng-repeat="comment in selectProductComments ">
                                            <div class="panel panel-default ">
                                                <a href=" ">{{comment.user_name}}</a>
                                                <span>分數：{{comment.stars}}</span>
                                                <p>{{comment.text}}</p>
                                            </div>
                                        </li>
                                    </ul>

                                    <div class="comment-creation ">
                                        <button class="ready-to-create-comment btn btn-default btn-block " ng-click="newComment.onClickFormVisible()
                                    " ng-show="newComment.enable && !newComment.formVisible ">發表評論</button>
                                        <div class="create-comment-form " ng-show="newComment.enable && newComment.formVisible ">
                                            <form novalidate>
                                                <!-- radio: 1, 2, 3, 4, 5 -->
                                                <label>評分：</label>
                                                <label class="radio-inline">
                                                    <input type="radio" name="stars" value="1" ng-model="newComment.stars"> 1
                                                </label>
                                                <label class="radio-inline">
                                                    <input type="radio" name="stars" value="2" ng-model="newComment.stars"> 2
                                                </label>
                                                <label class="radio-inline">
                                                    <input type="radio" name="stars" value="3" checked ng-model="newComment.stars"> 3
                                                </label>
                                                <label class="radio-inline">
                                                    <input type="radio" name="stars" value="4" ng-model="newComment.stars"> 4
                                                </label>
                                                <label class="radio-inline">
                                                    <input type="radio" name="stars" value="5" ng-model="newComment.stars"> 5
                                                </label>
                                                <br>
                                                <label>評論：</label>
                                                <textarea class="form-control" row="3" placeholder="最多 255 個字" ng-model="newComment.text "></textarea>
                                                <br>
                                                <button type="submit" class="btn btn-success pull-right" ng-click="newComment.onClickSubmit() ">發表</button>
                                                <button type="button" class="btn btn-default pull-right" ng-click="newComment.onClickCancel() ">取消</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- scripts -->
    <script type="text/javascript " src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js "></script>
    <script type="text/javascript " src="http://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js " type="text/javascript "></script>
    <script type="text/javascript " src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.16/angular.min.js "></script>
    <!-- local library scripts -->
    <script type="text/javascript" src="javascripts/datetime.js"></script>
    <script type="text/javascript" src="javascripts/angular-file-upload.min.js"></script>
    <script type="text/javascript" src="javascripts/cookies.js"></script>
    <script type="text/javascript" src="javascripts/xeditable.min.js"></script>
    <script type="text/javascript" src="javascripts/loading-bar.min.js"></script>
    <!-- user scripts -->
    <script type="text/javascript" src="javascripts/browse-module.js "></script>

    <!-- angular services -->
    <script type="text/javascript" src="javascripts/services/user-info.js "></script>

    <script type="text/javascript" src="javascripts/controllers/controller-tools.js "></script>
    <script type="text/javascript" src="javascripts/controllers/header.js "></script>
    <script type="text/javascript" src="javascripts/controllers/browse.js "></script>
</body>

</html>